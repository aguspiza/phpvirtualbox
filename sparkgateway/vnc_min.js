var svManager={getInstance:function(){var l=window.$vnc;return l&&l.running&&l.running()?l:null}};function connvertServer(l){var r={};r.id=l.id;r.server=l.id;r.displayName=l.displayName||l.id;if(l=l.vnc){for(var P in l)r[P]=l[P];r.pwd=l.password||""}return r}
svGlobal.Vnc=function(l,r,P,U){function oa(a,c){var e=[],d=null,f=new hi5.graphic.Rectangle(0,0,0,0),g="Uint8ClampedArray"in window;this.width=a;this.height=c;var b=!1,F=this;this.pause=function(a){b=a};this.isPaused=function(){return b};this.setContext=function(a){a!=d&&(d||!a||a.createImageData(1,1).data.buffer||(g=!1),d=a)};this.getContext=function(){return d};this.resize=function(f,d){for(var g=0;g<d;g++)e[g]=new Uint32Array(f);F.width=a=f;F.height=c=d};F.resize(a,c);this.getBuffer=function(){return e};
this.setRGB=function(a,c,f){e[c][a]=f|4278190080};this.getRGB=function(a,c){return e[c][a]};this.setRGBs=function(a,c,f,d,g,b,n){if(g){var m=0,h=0;f=a+f;d=c+d;for(var F=c;F<d;F++,b+=n)for(h=b,c=e[F],m=a;m<f;m++)c[m]=g[h++]}else console.log("pixel null")};this.moveArea=function(a,c,f,d,g,b){if(0<b){g=a+g;b=c+b;var n,m,h;for(n=d-1;0<=n;n--)for(m=e[b+n],h=e[c+n],d=0;d<f;d++)m[g+d]=h[a+d]}else if(0>b){g=a+g;b=c+b;var F;for(m=0;m<d;m++)for(h=e[b+m],F=e[c+m],n=0;n<f;n++)h[g+n]=F[a+n]}else if(0<g)for(g=
a+g,b=c+b,--f;0<=f;f--)for(m=g+f,h=a+f,n=0;n<d;n++)e[b+n][m]=e[c+n][h];else for(g=a+g,b=c+b,n=0;n<f;n++)for(h=g+n,F=a+n,m=0;m<d;m++)e[b+m][h]=e[c+m][F]};this.getRGBs=function(a,c,f,d){var g=_Uint32Array(f*d);g[0]=0;f=a+f;d=c+d;for(var b=0,m=c;m<d;m++)for(c=a;c<f;c++)g[b++]=e[m][c];return g};this.repaint=function(f,b,m,t){if(d){0>f&&(m+=f,f=0);0>b&&(t+=b,b=0);f+m>a&&(m=a-f);b+t>c&&(t=c-b);var F=d.createImageData(m,t),E=F.data;m=f+m;t=b+t;var n=0;if(g)for(var E=new Uint32Array(E.buffer),l,h=b;h<t;h++)for(l=
f;l<m;l++)E[n++]=e[h][l];else for(var q,k,h=b;h<t;h++)for(l=f;l<m;l++)q=e[h][l],k=n<<2,E[k]=q&255,E[k+1]=q>>8&255,E[k+2]=q>>16&255,E[k+3]=255,n++;d.putImageData(F,f,b)}};this.postPaint=function(a,c,d,e){0<f.width?f.union(a,c,d,e):(f.x=a,f.y=c,f.width=d,f.height=e)};this.commitPaint=function(){0<f.width&&(this.repaint(f.x,f.y,f.width,f.height),f.width=0)};this.fillRect=function(a,c,f,d,b){f=a+f;d=c+d;for(var g=c;g<d;g++)for(c=a;c<f;c++)e[g][c]=b}}function ba(){var a=l.indexOf("://"),c=l.substring(a+
3),a=c.indexOf("/");0<a&&(c=c.substring(0,a));return location.protocol+"//"+c}function pa(a){if(!sessionId)return"";a=hi5.browser.httpGet(ba()+"/CLIP?s="+sessionId+"&t="+(new Date).getTime(),!1);setTimeout(function(){q.send("883")},999);return a}function R(a){return"on"==a||"true"==a}function L(a,c,e){this.need=a;this.handler=c;this.repeat=e||1}function ca(a){var c=0,e=0,d=new Uint8Array(a),f=this,b=new L(0,null,0);this.getHandler=function(){return b};this.getData=function(){return d};this.getPosition=
function(){return c};this.setPosition=function(a){c=a};this.getEnd=function(){return e};this.set=function(a,f,b){d=a;c=f;e=b};this.handle=function(){b.handler(f,b)};this.setHandler=function(a){a&&1>a.need&&console.log("need < 1");(b=a)&&e-c>=a.need&&a.handler(f,a)};this.getByte=function(){return d[c++]};this.peekByte=function(){return d[c]};this.getBE32=function(){return d[c++]<<24|d[c++]<<16|d[c++]<<8|d[c++]};this.getBE16=function(){return d[c++]<<8|d[c++]};this.skip=function(a){c+=a};this.skipBack=
function(a){c-=a};this.getBytes=function(a,f){if(f)for(var b=0;b<a;b++)f[b]=d[c++];else return b=c,c+=a,d.subarray(b,c)};this.copyToByteArray=function(a,f,c,b){hi5.Arrays.arraycopy(d,c,a,f,b)};this.getString16LE=function(a,f){for(var c="",b=a;b<f;)var e=d[b++]|d[b++]<<8,c=c+String.fromCharCode(e);return c}}function qa(){if(!x){if(V)q=V,Q(k.width,k.height);else{var a=hi5.tool.replaceQuery(l,"pwd","x");hi5.browser.binaryWS()&&(a+="&binary=on");var c=window.opener;if(c){var e=null;try{e=c.__sparkUser}catch(d){}e&&
(c=e.account,e=e.session,c&&(a+="&account="+c),e&&(a+="&session="+e))}a+="&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0);q=new WebSocket(a,[]);q.binaryType="arraybuffer"}da.ws=q;svGlobal.logger.info(l);q.onopen=ra;q.onmessage=function(a){a=a.data;if("string"!=typeof a){var c=new Uint8Array(a);null!=G&&G.add(new RecordingObj(c,0,a.byteLength));B.set(c,0,a.byteLength);B.handle()}else{var d=parseInt(a.substring(0,2),16),c=a.substring(2);switch(d){case 26:a=JSON.parse(c);if(a.name){svGlobal.logger.info("msg="+
c);if(b.onerror)b.onerror(a);c=__svi18n.errorCode["S"+a.name]||"";c+=a.message;b.showMessage(c)}else 0<svGlobal.log&&console.erro("No error code for message:"+c);break;case 27:0!=hi5.appcfg.drawLicense&&v.drawLicense(c);break;case 56:a=JSON.parse(c);sessionId=a.session;a.server=b.server;if(c=hi5.$("joinSelect"))c.value=a.joinMode;if(c=hi5.$("requestControl"))c.disabled=a.hasControl;var c=hi5.appcfg.page&&hi5.appcfg.page.joinvnc||"joinvnc.html",c=location.protocol+"//"+location.host+"/"+c+"?id="+a.numericId,
e=a.webAddress;e&&0<e.length&&(d=e.indexOf("://"),e=e.substring(d+3),d=e.indexOf("/"),0<d&&(e=e.substring(0,d)),e.toLowerCase()!=location.host.toLowerCase()&&(c+="&gateway="+e));a.joinLink=c;b.sessionInfo.appInfo=a;a.ver&&a.ver!=svGlobal.version&&console.log("Client:"+svGlobal.version+" server:"+a.ver);if(b.onsessionstart)b.onsessionstart(b.sessionInfo);break;case 59:a=hi5.Base64.dec(c,0);(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)&256||v.disableShadow();break;case 61:a=JSON.parse(c);switch(a.type){case 0:Q(a.width,
a.height);M=a.color/8|0;a.server&&(b.server=a.server,b.setTitle&&(document.title=k.displayName||b.server));playLength=a.length;v&&v.setAutoScale(!0);if(b.onopened)b.onopened(a);break;case 1:a=a.duration;if(b.onprogress)b.onprogress(a,playLength);break;case 2:2==a.status?(ea(),x=!0):(c=0==a.status,w.pause(c),c||w.repaint(0,0,w.width,w.height),a.warn&&b.showMessage(c?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:fa(c);break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}}};
q.onclose=function(a){svGlobal.logger.warn("closed, code="+a.code+" reason="+a.reason);if(!x&&0==b.mode){(a=__svi18n.errorCode.connection)||(a="error connection");if(b.onerror)b.onerror({name:"connection",message:a});b.displayMsg&&hi5.notifications.notify({msg:a});0<svGlobal.log&&console.error(a)}N=x=!1;try{null!=G&&(G.exit(),G=null),v&&v.close()}catch(c){}window&&window.$vnc&&(window.$vnc=null);if(b&&b.onclose)b.onclose()};q.onerror=sa}}function ra(a){svGlobal.logger.info("opened...");x=!0;q.send("87"+
navigator.userAgent);if(b.onopen)b.onopen()}function sa(a){svGlobal.logger.warn(a)}function W(a){B.setHandler(null);if(q&&x){q.onmessage=null;try{q.send("85"),q.close()}catch(c){}}window&&window.$vnc&&(window.$vnc=null);null!=G&&(G.exit(),G=null)}function ga(){var a=new Uint8Array(1);a[0]=R(k.share)?1:0;q.send(a.buffer);B.setHandler(new L(24,function(a){if(b.onloggedin)b.onloggedin();var e=b.sessionInfo;e.width=I=a.getBE16();e.height=J=a.getBE16();e.bpp=a.getByte();e.depth=a.getByte();e.bigEndian=
0!=a.getByte();e.trueColor=0!=a.getByte();a.skip(12);for(var d=a.getBE32(),f="",g=0;g<d;g++)f+=String.fromCharCode(a.getByte());e.name=f;console.log("server name:"+f);b.setTitle&&(document.title=f);Q(I,J);a=[16,7,1,0,4294967056,4294967057,4294967064,4294967073,4294967040,4294967264];e=k.encoding;8==k.color&&"Tight"==e&&(e="ZRLE");switch(e){case "Tight":a[0]=7;a[1]=16;break;case "Raw":a[0]=0,a[3]=16}a[8]+=parseInt(k.compression||6);a[9]+=parseInt(k.quality||5);e=a.length;d=new Uint8Array(4+4*e);d[0]=
2;d[2]=e>>8&255;d[3]=e&255;for(f=0;f<e;f++)d[4+4*f]=a[f]>>24&255,d[5+4*f]=a[f]>>16&255,d[6+4*f]=a[f]>>8&255,d[7+4*f]=a[f]&255;q.send(d.buffer);a=parseInt(k.color);switch(a){case 32:ha(32,24,!1,!0,255,255,255,0,8,16);break;case 8:ha(8,8,!1,!0,7,7,3,0,3,6);break;default:console.log("invliad color depath:"+a)}M=a/8|0;X(0,0,I,J,!1);B.setHandler(ia);N=!0;void 0!=k.recording&&"on"==k.recording&&(a=k,G=new RecordingManager,G.setHeader({name:a.server,width:a.width,height:a.height,color:a.server_bpp,namesuffix:".vncv",
filetag:"VNCV",duration:0}))}))}function ta(a){a=a.getBE32();console.log("sec rst: "+a);switch(a){case 0:break;case 1:b.showMessage(__svi18n.vnc.authError);b.close();return;case 2:b.showMessage("Too many failed authentication");b.close();return;default:b.showMessage("Unknown auth error"+a);b.close();return}ga()}function ha(a,c,b,d,f,g,m,l,k,r){var p=new Uint8Array(20);p[0]=0;p[4]=a;p[5]=c;p[6]=b?1:0;p[7]=d?1:0;p[8]=f>>8&255;p[9]=f&255;p[10]=g>>8&255;p[11]=g&255;p[12]=m>>8&255;p[13]=m&255;p[14]=l;
p[15]=k;p[16]=r;q.send(p.buffer)}function X(a,c,b,d,f){var g=new Uint8Array(10);g[0]=3;g[1]=f?1:0;g[2]=a>>8&255;g[3]=a&255;g[4]=c>>8&255;g[5]=c&255;g[6]=b>>8&255;g[7]=b&255;g[8]=d>>8&255;g[9]=d&255;q.send(g.buffer)}function ja(){var a=new TINF;a.init(2==b.mode?120:0);var c=new ca(0),e=Array(4096);e[0]=0;var d=Array(128);d[0]=0;this.getHistory=function(){return a.getHistory()};this.setHistory=function(c){a.setHistory(c)};this.decode=function(b,g,m,l,q){var k=b.getBE32();b=b.getBytes(k);b=a.uncompress(b,
0);var p=0,t=0;c.set(b.dest,0,b.destIndex);b=m;var k=g,K=0,E=0,p=0,t=!1,n=0,z=p=t=0,h=c.getByte;for(b=m;b<m+q;b+=64)for(K=Math.min(m+q-b,64),k=g;k<g+l;k+=64){E=Math.min(g+l-k,64);p=h();t=0!=(p&128);n=p&127;if(1==M)for(p=0;p<n;p++)d[p]=S[h()];else for(p=0;p<n;p++)d[p]=h()|h()<<8|h()<<16|4278190080;if(1==n)w.fillRect(k,b,E,K,d[0]);else{if(t)if(0==n)for(t=0,p=t+E*K;t<p;){var z=1==M?S[h()]:h()|h()<<8|h()<<16|4278190080,y=1;do n=h(),y+=n;while(255==n);for(;0<y--;)e[t++]=z}else for(t=0,p=t+E*K;t<p;){z=
h();y=1;if(0!=(z&128)){do n=h(),y+=n;while(255==n)}z&=127;for(z=d[z];0<y--;)e[t++]=z}else if(t=E*K,0==n)if(1==M)for(p=0;p<t;p++)e[p]=S[h()];else for(p=0;p<t;p++)e[p]=h()|h()<<8|h()<<16|4278190080;else for(y=16<n?8:4<n?4:2<n?2:1,p=t=0;p<K;p++)for(var z=t+E,r=n=0;t<z;)0==r&&(n=h(),r=8),r-=y,e[t++]=d[n>>r&(1<<y)-1&127];w.setRGBs(k,b,E,K,e,0,E)}}w.postPaint(g,m,l,q)}}function ka(){function a(a,c,b,d,e){this.draw=function(){H.fillStyle=e;H.fillRect(a,c,b,d)};this.type=0;this.ready=function(){return!0}}
function c(a,c,b){this.draw=function(){H.putImageData(b,a,c)};this.type=1;this.ready=function(){return!0}}function e(a,c,b){this.draw=function(){H.drawImage(b,a,c)};this.type=2;this.ready=function(){return!!b.src&&b.complete};this.image=b}function d(){var a=m[g];a||(a=new TINF,a.init(2==b.mode?120:0),m[g]=a);return a}function f(a){var c=a.getByte(),b=c&127;c&128&&(c=a.getByte(),b|=(c&127)<<7,c&128&&(b|=a.getByte()<<14));return b}var g=0,m={},l=[0],k=Array(256);k[0]=0;this.inUse=!1;var q=this,p=new function(){function a(){for(;0<
c.length;){var b=c[0];if(!b.ready())break;b.draw();c.shift()}}var c=[];this.push=function(b){c.push(b);2==b.type?b.image.onload=a:a()}};this.decode=function(b,m,r,n,z){q.inUse=!0;var h=b.getByte();switch(h>>4){case 8:p.push(new a(m,r,n,z,"rgb("+b.getByte()+","+b.getByte()+","+b.getByte()+")"));break;case 9:h=f(b);n=hi5.Base64.enc(b.getData(),h,b.getPosition());b.skip(h);z=new Image;p.push(new e(m,r,z));z.src="data:image/jpeg;base64,"+n;break;default:if(g=(h&48)>>4,h=h&64?b.getByte():0,1==h){for(var y=
b.getByte,w=y()+1,u=2!=w?n*z:z*((n+7)/8|0),C=0,v=0,D=h=0;C<w;C++)k[C]=y()|y()<<8|y()<<16|4278190080;12>u?l=b.getBytes(u):(h=f(b),l=d().uncompress(b.getBytes(h),0).dest);b=l;y=H.createImageData(n,z);if("Uint8ClampedArray"in window){var A=new Uint32Array(y.data.buffer);if(2!=w)for(C=0;C<u;C++)A[C]=k[b[C]];else for(h=0,C=(n+7)/8|0,u=v=w=0;u<z;u++){for(var w=u*C,x=0;x<(n/8|0);x++)for(v=b[w+x],D=7;0<=D;D--)A[h++]=k[v>>D&1];v=8-n%8;for(D=7;D>=v;D--)A[h++]=k[b[w+x]>>D&1]}}else if(A=y.data,h=0,2!=w)for(C=
0;C<u;C++)v=k[b[C]],A[h++]=v&255,A[h++]=v>>8&255,A[h++]=v>>16&255,A[h++]=255;else for(var h=0,C=(n+7)/8|0,B=0,u=0;u<z;u++){w=u*C;for(x=0;x<(n/8|0);x++)for(v=b[w+x],D=7;0<=D;D--)B=k[v>>D&1],A[h++]=B&255,A[h++]=B>>8&255,A[h++]=B>>16&255,A[h++]=255;v=8-n%8;for(D=7;D>=v;D--)B=k[b[w+x]>>D&1],A[h++]=B&255,A[h++]=B>>8&255,A[h++]=B>>16&255,A[h++]=255}p.push(new c(m,r,y))}else if(0==h){h=n*z*3;11<h&&(h=f(b));D=n*z;y=3*D;b=11<y?d().uncompress(b.getBytes(h),0).dest:b.getBytes(y);y=H.createImageData(n,z);A=y.data;
for(C=n=h=0;C<D;C++)A[h++]=b[n++],A[h++]=b[n++],A[h++]=b[n++],A[h++]=255;p.push(new c(m,r,y))}else console.log("xx filter:"+h)}}}function fa(a){var c=parseInt(a.substring(0,1),16),e,d,f=a.substring(1),g=!1;e=b.sessionInfo.appInfo;switch(c){case 0:d=JSON.parse(f);ea();x=!0;g=d.width;e=d.height;if(g==I&&e==J)break;Q(g,e);break;case 1:_reconnectOnResize=b.reconnectOnResize;b.reconnectOnResize=!1;d=JSON.parse(f);b.onsessionjoin&&(g=b.onsessionjoin(d));if(g)break;b.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,
d.__ip,d.name]));break;case 2:d=JSON.parse(f);0==d.joined&&(b.reconnectOnResize=_reconnectOnResize);b.onsessionexit&&(g=b.onsessionexit(d));if(g)break;b.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(f);e.joinMode!=d.mode&&(e.joinMode=d.mode,a=hi5.$("joinSelect"))&&(a.value=d.mode);if(e.hasControl)break;v.setReadOnly(!1);if(e=hi5.$("requestControl"))e.disabled=!0;b.ongivecontrol&&(g=b.ongivecontrol());if(g)break;b.showMessage(__svi18n.info.givecontrol);
break;case 4:v.setReadOnly(!0);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;b.ontakebackcontrol&&(g=b.ontakebackcontrol());if(g)break;b.showMessage(__svi18n.info.nocontrol);break;case 5:d=JSON.parse(f);b.onrequirecontrol&&(g=b.onrequirecontrol(d));if(g)break;g=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({title:g,msg:__svi18n.info.recontrol,cbYes:function(){b.giveControl(d.numericId);this.destroy()},cbNo:function(){b.refuseControl(d.numericId);
this.destroy()}});break;case 10:if(1==a.length)q.send("8E8"+hi5.Base64.enc(T.getHistory()));else if(T.setHistory(hi5.Base64.dec(a.substring(1),0)),b.refresh(),N=!0,b.onloggedin)b.onloggedin();break;case 11:d=JSON.parse(f);b.onrequirejoin&&(g=b.onrequirejoin(d));if(g)break;g=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);hi5.notifications.notify({title:g,msg:__svi18n.info.reqjoin,cbYes:function(){b.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){b.allowJoin(d.numericId,!1);this.destroy()}})}}
function ua(a){if(!b.openLink)return!1;var c=a;a=a.toLowerCase();var e=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");e||(0==a.indexOf("www.")?(e=!0,a="http://"+a):0==a.indexOf("ftp.")&&(e=!0,a="ftp://"+a));if(e){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(b.onurlredirection&&b.onurlredirection(e))return!0;v.processLink(c);return!0}return!1}function Q(a,c){I=a;J=c;k.width=a;k.height=c;w.resize(a,
c);v&&v.setSize(a,c);if(b.onresolutionchange)b.onresolutionchange(a,c)}function va(a){if(N&&(a=a.getData("text/plain"))){var b=a.length,e=new Int8Array(8+b);e[0]=6;e[4]=b>>24&255;e[5]=b>>16&255;e[6]=b>>8&255;e[7]=b&255;for(var d=0;d<b;d++)e[8+d]=a.charCodeAt(d);q.send(e.buffer)}}function ea(){loggedin=x=!1;Y=new ka;T=new ja}function Z(a,b,e,d){N&&(la=a,(a?1<<b:0)!=u[1]||e!=(u[2]<<8|u[3])||d!=(u[4]<<8|u[5]))&&(u[1]=a?1<<b:0,u[2]=e>>8&255,u[3]=e&255,u[4]=d>>8&255,u[5]=d&255,q.send(u.buffer))}function aa(a,
b){O[1]=a?1:0;O[4]=b>>24&255;O[5]=b>>16&255;O[6]=b>>8&255;O[7]=b&255;q.send(O.buffer)}function ma(a,c){var e=wa[c.toLowerCase()];e?b.writeScancode(a,e):(e=c.length,0!=e&&(1==e?b.writeKeyCode(a,c.toUpperCase().charCodeAt(0)):a&&b.writeText(c)))}sessionStorage&&sessionStorage.clear();this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;var V="object"==typeof l?l:null,na="object"==typeof l||0<l.indexOf("/PLAY?");na?(this.mode=1,V&&(l=""),l+="&touchpad=on"):0<l.indexOf("/JOIN?")&&
(this.mode=2,this.reconnectOnResize=!1);var k=hi5.tool.queryToObj(l.substring(l.indexOf("?")+1));!k.width&&r&&(k.width=r,l+="&width="+r);!k.wHeight&&P&&(k.height=P,l+="&height="+P);!k.color&&U&&(k.color=U,l+="&color="+U);k.color||(k.color=32);this.server=k.server;this.port=parseInt(k.port,10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var v=null,x=!1,N=!1,G=null;window.$vnc=this;var B=new ca(4194304);this.__que=B;this.running=function(){return x};var b=this,
q=null,M=4,I=1024,J=768,S=[-16777216,-16777180,-16777143,-16777107,-16777070,-16777034,-16776997,-16776961,-16768E3,-16767964,-16767927,-16767891,-16767854,-16767818,-16767781,-16767745,-16758528,-16758492,-16758455,-16758419,-16758382,-16758346,-16758309,-16758273,-16749312,-16749276,-16749239,-16749203,-16749166,-16749130,-16749093,-16749057,-16739840,-16739804,-16739767,-16739731,-16739694,-16739658,-16739621,-16739585,-16730624,-16730588,-16730551,-16730515,-16730478,-16730442,-16730405,-16730369,
-16721152,-16721116,-16721079,-16721043,-16721006,-16720970,-16720933,-16720897,-16711936,-16711900,-16711863,-16711827,-16711790,-16711754,-16711717,-16711681,-11206656,-11206620,-11206583,-11206547,-11206510,-11206474,-11206437,-11206401,-11197440,-11197404,-11197367,-11197331,-11197294,-11197258,-11197221,-11197185,-11187968,-11187932,-11187895,-11187859,-11187822,-11187786,-11187749,-11187713,-11178752,-11178716,-11178679,-11178643,-11178606,-11178570,-11178533,-11178497,-11169280,-11169244,-11169207,
-11169171,-11169134,-11169098,-11169061,-11169025,-11160064,-11160028,-11159991,-11159955,-11159918,-11159882,-11159845,-11159809,-11150592,-11150556,-11150519,-11150483,-11150446,-11150410,-11150373,-11150337,-11141376,-11141340,-11141303,-11141267,-11141230,-11141194,-11141157,-11141121,-5636096,-5636060,-5636023,-5635987,-5635950,-5635914,-5635877,-5635841,-5626880,-5626844,-5626807,-5626771,-5626734,-5626698,-5626661,-5626625,-5617408,-5617372,-5617335,-5617299,-5617262,-5617226,-5617189,-5617153,
-5608192,-5608156,-5608119,-5608083,-5608046,-5608010,-5607973,-5607937,-5598720,-5598684,-5598647,-5598611,-5598574,-5598538,-5598501,-5598465,-5589504,-5589468,-5589431,-5589395,-5589358,-5589322,-5589285,-5589249,-5580032,-5579996,-5579959,-5579923,-5579886,-5579850,-5579813,-5579777,-5570816,-5570780,-5570743,-5570707,-5570670,-5570634,-5570597,-5570561,-65536,-65500,-65463,-65427,-65390,-65354,-65317,-65281,-56320,-56284,-56247,-56211,-56174,-56138,-56101,-56065,-46848,-46812,-46775,-46739,-46702,
-46666,-46629,-46593,-37632,-37596,-37559,-37523,-37486,-37450,-37413,-37377,-28160,-28124,-28087,-28051,-28014,-27978,-27941,-27905,-18944,-18908,-18871,-18835,-18798,-18762,-18725,-18689,-9472,-9436,-9399,-9363,-9326,-9290,-9253,-9217,-256,-220,-183,-147,-110,-74,-37,-1],w;w?w.resize(1024,768):w=new oa(1024,768);var H=w.getContext(),da=new function(){this.ws=null;this.setJoinMode=b.setJoinMode;this.requestControl=b.requestControl;this.writeKeyComb=b.writeKeyComb;this.getAppMode=function(){return b.mode};
this.send=function(a){x&&this.ws.send(a)};this.sendInput=function(a){b.writeRawInput(a);if(b.onactivity)b.onactivity(a)};this.getAppInfo=function(){return b.sessionInfo.appInfo};this.onresize=function(a){};this.onorientationchange=function(a){};this.getClipData=pa;this.onfocus=function(a){};this.fileCallback=[];this.getShareFiles=function(a,b){loggedin&&(this.ws.send("3A5"+a),this.fileCallback.push(b))};this.notifyFiles=function(a){for(var b=this.fileCallback,e=0,d=b.length;e<d;e++)b[e](a)};this.getFile=
function(a){window.open(b.getFileUrl(a))};this.removeFile=function(a){uploadMgr&&uploadMgr.fileService.remove(a)};this.getFileLink=function(a){return ba()+"/DOWNLOAD?s="+sessionId+"&f="+a};this.getGateway=function(){return l};this.reconnect=function(a,b,e){}};hi5.appcfg&&(r=hi5.appcfg,"undefined"!=typeof r.displayMsg&&(this.displayMsg=r.displayMsg),"undefined"!=typeof r.reconnectTimes&&(this.reconnectTimes=r.reconnectTimes),"undefined"!=typeof r.openLink&&(this.openLink=r.openLink),"undefined"!=typeof r.setTitle&&
(this.setTitle=r.setTitle),"boolean"==typeof r.useWSS&&(l=(hi5.appcfg.useWSS?"wss":"ws")+l.substring(l.indexOf("://"))));this.getURL=function(){return l};var xa=parseInt(k.server_bpp||k.color||24);this.getColor=function(){return xa};window.onerror=function(a,b,e){console.log("Uncatched error, msg: "+a+" url: "+b+" line: "+e)};this.setJoinMode=function(a){x&&q.send("8E1"+a)};this.refuseControl=function(a){x&&q.send("8E3"+a)};this.giveControl=function(a){x&&q.send("8E4"+a)};this.requestControl=function(){x&&
q.send("8E2")};this.allowJoin=function(a,b){x&&q.send("8EA"+a+"\t"+(b?1:0))};this.play=function(){q.send("F3")};this.pause=function(){q.send("F2")};this.scan=function(a){q.send("F4"+(a?"1":"0"))};this.seek=function(a){console.log("call for vnc");v&&x&&(q.send("F4"+(a?"1":"0")+"\t"+(a/v.getScale()|0)),w.pause(!0))};this.run=function(){setTimeout(qa,5)};this.hide=function(){v&&v.hide()};this.showMessage=function(a){b.displayMsg&&a&&hi5.notifications.notify({msg:a})};this.close=W;hi5.browser.isChromeApp?
chrome.runtime.onSuspend.addListener(W):window.addEventListener("unload",W,!1);r=new L(12,function(a){if(82!=a.getByte()||70!=a.getByte()||66!=a.getByte())b.showMessage(__svi18n.vnc.notvnc),b.close();else{a.skip(1);b.sessionInfo.major=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);a.skip(1);b.sessionInfo.minor=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48);console.log("RFB major: "+b.sessionInfo.major+" minor: "+b.sessionInfo.minor);a.skip(1);a=new Uint8Array(12);for(var c=0;12>
c;c++)a[c]="RFB 003.003\n".charCodeAt(c);q.send(a.buffer);B.setHandler(new L(4,function(a){var c=a.getBE32();console.log("sec type:"+c);switch(c){case 1:ga();break;case 2:B.setHandler(new L(12,function(){console.log("vnc auth");var b=new Int8Array(16);a.copyToByteArray(b,0,a.getPosition(),16);a.skip(16);var c=k.pwd||"";8<c.length&&(c=c.substring(0,8));for(var d=[0,0,0,0,0,0,0,0],l=0,r=c.length;l<r;l++)d[l]=c.charCodeAt(l);c=new DesCipher(d);c.encrypt(b,0,b,0);c.encrypt(b,8,b,8);q.send(b.buffer);B.setHandler(new L(4,
ta))}));break;default:b.showMessage(__svi18n.vnc.securityError),b.close()}}))}});B.setHandler(r);this.refresh=function(){X(0,0,I,J,!1)};var ia=new L(1,function(a){var c=0,e=0,d=0,f=0,g=0,m="",m=a.getByte();switch(m){case 0:a.skip(1);for(var m=a.getBE16(),l=0;l<m;l++)switch(c=a.getBE16(),e=a.getBE16(),d=a.getBE16(),f=a.getBE16(),g=a.getBE32()>>>0,g){case 4294967073:Q(d,f);break;case 240:case 4294967056:0!=d*f&&a.skip(((d+7)/8|0)*f*2+6);break;case 4294967057:0!=d*f&&a.skip(d*f*M+((d+7)/8|0)*f);break;
case 4294967064:break;case 0:if(0<d*f){var g=a,k=null,q=d*f,p=0,t=g.getPosition(),r=g.getData();switch(M){case 4:if(0==t%4){t+=3;for(p=0;p<q;p++)r[t]=255,t+=4;k=new Uint32Array(g.getData().buffer,g.getPosition(),q)}else for(k=new Uint32Array(q),p=0;p<q;p++)k[p]=r[t++]|r[t++]<<8|r[t++]<<16|4278190080,t++;g.skip(4*q);break;case 1:k=new Uint32Array(q);for(p=0;p<q;p++)k[p]=S[r[t++]];g.skip(q)}w.setRGBs(c,e,d,f,k,0,d);w.postPaint(c,e,d,f)}break;case 1:g=a.getBE16();k=a.getBE16();Y.inUse?H.putImageData(H.getImageData(g,
k,d,f),c,e):(w.moveArea(g,k,d,f,c-g,e-k),w.repaint(c,e,d,f));break;case 7:Y.decode(a,c,e,d,f);break;case 16:T.decode(a,c,e,d,f);break;default:console.log("Encoding "+g+" is not supported"),b.close()}w.commitPaint();X(0,0,I,J,!0);break;case 1:console.log("xxx color map");break;case 2:break;case 3:a.skip(3);m=a.getBE32();if(0<m){a=a.getBytes(m);m=String.fromCharCode.apply(null,a);if(b.onservercopy&&b.onservercopy(m))break;ua(m)||v.copyToClip("text/plain;"+m)}break;case 48:m=a.getString16LE(0,a.getEnd());
fa(m);a.skip(a.getEnd()-a.getPosition());break;default:console.log("XX PDU:"+m)}});2!=b.mode&&1!=b.mode||B.setHandler(ia);var Y=new ka,T=new ja;this.addSurface=function(a){v=a;na&&a.setPlayerMode();w.setContext(v.context);H=w.getContext();a.setAutoScale(0<b.mode);a.setSize(I,J);a.setController(da);a.setFastCopy(R(k.fastCopy));a.setTouchpad(R(k.touchpad));a.setClipboard(R(k.mapClipboard));a.run(99997);a.onclipdata=va};var u=new Uint8Array(6);u[0]=5;var la=!1;this.mouseDown=function(a,b,e){Z(!0,e,a,
b)};this.mouseMove=function(a,b){Z(la,0,a,b)};this.mouseUp=function(a,b,e){Z(!1,e,a,b)};this.writeKeyCode=function(a,c){b.writeRawInput("8B"+(a?0:49152)+"\t"+c)};this.writeScancode=function(a,c){x&&("number"==typeof a?(b.writeRawInput("840\t"+a),b.writeRawInput("8449152\t"+a)):b.writeRawInput("84"+(a?0:49152)+"\t"+c))};this.writeText=function(a){b.writeRawInput("86"+a)};var ya={57:32,201:65365,209:65366,207:65367,199:65360,203:65361,200:65362,205:65363,208:65364,183:65377,210:65379,211:65535,184:65514,
219:65511,220:65512,1:65307,14:65288,15:65289,28:65293,29:65511,29:65507,42:65505,56:65513,59:65470,60:65471,61:65472,62:65473,63:65474,64:65475,65:65476,66:65477,67:65478,68:65479,87:65480,88:65481,70:65300},O=new Uint8Array(8);O[0]=4;this.writeRawInput=function(a){if(N){var c=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");var e=0,d=!1;switch(c){case 128:b.mouseDown(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;case 129:b.mouseUp(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));return;
case 130:b.mouseMove(parseInt(a[0]),parseInt(a[1]));return;case 131:e=0!=parseInt(a[2]);c=parseInt(a[0]);a=parseInt(a[1]);N&&(u[1]=e?16:8,u[2]=c>>8&255,u[3]=c&255,u[4]=a>>8&255,u[5]=a&255,q.send(u.buffer),u[1]=2,q.send(u.buffer));return;case 132:e=ya[a[1]]||0;d=0==a[0];break;case 139:e=String.fromCharCode(parseInt(a[1])).toLowerCase().charCodeAt(0);d=0==a[0];break;case 134:c=0;for(d=a[0].length;c<d;c++)e=a[0].charCodeAt(c),aa(!0,e),aa(!1,e);return}0<e?aa(d,e):console.log("Unknowncode: "+a[1]+" type:"+
c)}};var wa={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.writeKeyComb=function(a){a=a.split("+");var b=a.length;if(0!=b){for(var e=null,d=0;d<b;d++){var f=
a[d];""==f&&""==e&&(f="Add");""!=f&&ma(!0,f);e=f}for(d=b-1;0<=d;d--)f=a[d],""==f&&""==e&&(f="Add"),""!=f&&ma(!1,f),e=f}}};
